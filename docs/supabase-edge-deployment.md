# Supabase Edge Function Deployment Guide

This document explains how to deploy the Supabase Edge Functions that live in
`supabase/functions/` using either the GitHub Actions workflow bundled with the
repository or the Supabase CLI directly from your machine.

## 1. Gather the required credentials

You will need two values to deploy Edge Functions:

| Variable | Description |
| --- | --- |
| `SUPABASE_ACCESS_TOKEN` | A personal access token created from the Supabase dashboard (Settings → Access Tokens) or a service role token. |
| `SUPABASE_PROJECT_ID` | The project reference/id visible in the dashboard URL (e.g. `ucaqbhmyutlnitnedowk`). |

The public anon or publishable keys are **not** sufficient to deploy Edge
Functions. Make sure you generate a token with the `functions.deploy`
permission.

## 2. Deploy via GitHub Actions

1. Open your repository on GitHub and navigate to **Settings → Secrets and
   variables → Actions**.
2. Create two repository secrets:
   - `SUPABASE_ACCESS_TOKEN`: paste the token from step 1.
   - `SUPABASE_PROJECT_ID`: paste your project id, for example `ucaqbhmyutlnitnedowk`.
3. Push a commit touching files in `supabase/functions/` or trigger the workflow
   manually from the **Actions** tab by selecting "Deploy Supabase Edge
   Functions" and clicking **Run workflow**.
4. The workflow defined in `.github/workflows/deploy-edge-functions.yml` checks
   out the repository, installs the Supabase CLI, and deploys every function
   directory that is not prefixed with an underscore using the shared import map.

If the secrets are missing, the workflow will stop immediately with a clear
error message so you can add them before rerunning.

## 3. Deploy locally with the Supabase CLI

For development environments where you prefer to deploy without GitHub Actions,
use the helper script located at `supabase/scripts/deploy-edge-functions.sh`.

```bash
# Install the Supabase CLI if you have not already
npm install -g supabase

# Export your credentials
export SUPABASE_ACCESS_TOKEN="<your-access-token>"
export SUPABASE_PROJECT_ID="ucaqbhmyutlnitnedowk"

# Deploy every function
./supabase/scripts/deploy-edge-functions.sh

# Or deploy a subset by listing their directories
./supabase/scripts/deploy-edge-functions.sh chess-insights generate-chess-rule
```

The script validates that the Supabase CLI is available, that both required
environment variables are present, and that the shared import map exists before
attempting a deployment. It also verifies each requested function name and
prints a friendly list when a typo is detected.

## 4. Troubleshooting

- **Missing import map**: Ensure `supabase/functions/import_map.json` exists and
  is committed. The workflow and helper script both rely on it.
- **Permission denied**: Confirm that the token includes the `functions.deploy`
scope. Personal tokens must be generated by a project owner.
- **Function specific errors**: The Supabase CLI prints the deployment output of
  each function. Inspect the logs in the Actions run or your terminal to find
  the error message returned by Supabase.

With these steps you can deploy the Edge Functions either automatically via
GitHub or manually from any environment that has the Supabase CLI installed.
